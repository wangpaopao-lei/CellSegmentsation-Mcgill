2024-03-06 13:41:16.449818: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/cv2/../../lib64:/usr/local/cuda-12.1/lib64:
2024-03-06 13:41:16.449903: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
/home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/spaghetti/network.py:40: FutureWarning:

The next major release of pysal/spaghetti (2.0.0) will drop support for all ``libpysal.cg`` geometries. This change is a first step in refactoring ``spaghetti`` that is expected to result in dramatically reduced runtimes for network instantiation and operations. Users currently requiring network and point pattern input as ``libpysal.cg`` geometries should prepare for this simply by converting to ``shapely`` geometries.

2024-03-06 13:41:21.541155: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 13:41:21.541633: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 13:41:21.542005: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 13:41:21.542379: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 13:41:21.542757: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 13:41:21.543361: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/cv2/../../lib64:/usr/local/cuda-12.1/lib64:
2024-03-06 13:41:21.543514: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcublas.so.11'; dlerror: libcublas.so.11: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/cv2/../../lib64:/usr/local/cuda-12.1/lib64:
2024-03-06 13:41:21.543652: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcublasLt.so.11'; dlerror: libcublasLt.so.11: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/cv2/../../lib64:/usr/local/cuda-12.1/lib64:
2024-03-06 13:41:21.543785: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcufft.so.10'; dlerror: libcufft.so.10: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/cv2/../../lib64:/usr/local/cuda-12.1/lib64:
2024-03-06 13:41:21.544853: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcusparse.so.11'; dlerror: libcusparse.so.11: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/cv2/../../lib64:/usr/local/cuda-12.1/lib64:
2024-03-06 13:41:21.544923: W tensorflow/core/common_runtime/gpu/gpu_device.cc:1850] Cannot dlopen some GPU libraries. Please make sure the missing libraries mentioned above are installed properly if you would like to use GPU. Follow the guide at https://www.tensorflow.org/install/gpu for how to download and setup the required libraries for your platform.
Skipping registering GPU devices...
2024-03-06 13:41:21.545268: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
/home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/ot/backend.py:2998: UserWarning:

To use TensorflowBackend, you need to activate the tensorflow numpy API. You can activate it by running: 
from tensorflow.python.ops.numpy_ops import np_config
np_config.enable_numpy_behavior()

|-----> Constructing count matrices.
|-----> <insert> __type to uns in AnnData Object.
|-----> <insert> pp to uns in AnnData Object.
|-----> <insert> spatial to uns in AnnData Object.
|-----> <select> stain layer in AnnData Object
|-----> Constructing nuclei mask from staining image.
|-----> <insert> stain_mask to layers in AnnData Object.
|-----> <select> stain_mask layer in AnnData Object
|-----> Finding peaks with minimum distance 7.
|-----> <insert> stain_distances to layers in AnnData Object.
|-----> <insert> stain_markers to layers in AnnData Object.
|-----> <select> stain layer in AnnData Object
|-----> <select> stain_mask layer in AnnData Object
|-----> <select> stain_markers layer in AnnData Object
|-----> Running Watershed.
|-----> <insert> watershed_labels to layers in AnnData Object.
|-----> <select> watershed_labels layer in AnnData Object
/home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/anndata/_core/anndata.py:183: ImplicitModificationWarning:

Transforming to str index.

/home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/anndata/_core/anndata.py:183: ImplicitModificationWarning:

Transforming to str index.

watershed labels prepared.
(1200, 1200, 2000)
gene data prepared.
batch folder exists
finished 8%
finished 17%
finished 25%
finished 33%
finished 42%
finished 50%
finished 58%
finished 67%
finished 75%
finished 83%
finished 92%
finished 100%
Core samples: 16952, Outer samples: 320161
done!
第一个脚本已完成运行
2024-03-06 14:59:26.955480: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-12.1/lib64:
2024-03-06 14:59:26.955538: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
2024-03-06 15:00:05.145221: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 15:00:05.145599: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 15:00:05.145917: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 15:00:05.146232: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 15:00:05.146543: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:936] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2024-03-06 15:00:05.146917: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-12.1/lib64:
2024-03-06 15:00:05.147103: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcublas.so.11'; dlerror: libcublas.so.11: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-12.1/lib64:
2024-03-06 15:00:05.147279: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcublasLt.so.11'; dlerror: libcublasLt.so.11: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-12.1/lib64:
2024-03-06 15:00:05.147481: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcufft.so.10'; dlerror: libcufft.so.10: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-12.1/lib64:
2024-03-06 15:00:05.149004: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcusparse.so.11'; dlerror: libcusparse.so.11: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-12.1/lib64:
2024-03-06 15:00:05.149055: W tensorflow/core/common_runtime/gpu/gpu_device.cc:1850] Cannot dlopen some GPU libraries. Please make sure the missing libraries mentioned above are installed properly if you would like to use GPU. Follow the guide at https://www.tensorflow.org/install/gpu for how to download and setup the required libraries for your platform.
Skipping registering GPU devices...
2024-03-06 15:00:05.149319: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
results folder exists.
Epoch 1/20
Epoch 1: Actual Labels: [0 0 1 1 1 1 1 0 0 1 0 0 0 1 0 1 0 0 0 1 1 1 1 0 0 0 0 0 1 0 1 0]
Epoch 1: Predictions:
 [[0.4283442 ]
 [0.55037737]
 [0.4640859 ]
 [0.5364939 ]
 [0.47568947]
 [0.43606424]
 [0.5297824 ]
 [0.42777306]
 [0.5787893 ]
 [0.53219515]
 [0.4713625 ]
 [0.5407837 ]
 [0.482618  ]
 [0.4436019 ]
 [0.46552908]
 [0.5634401 ]
 [0.4870866 ]
 [0.4430858 ]
 [0.49295452]
 [0.56700975]
 [0.55344534]
 [0.46647274]
 [0.48075703]
 [0.43792623]
 [0.51785266]
 [0.5404566 ]
 [0.4460091 ]
 [0.43607265]
 [0.4654871 ]
 [0.45136952]
 [0.5694144 ]
 [0.45693937]]
679/679 - 22s - loss: 0.6987 - accuracy: 0.5251 - val_loss: 0.6806 - val_accuracy: 0.5799 - 22s/epoch - 32ms/step
Epoch 2/20
679/679 - 17s - loss: 0.6830 - accuracy: 0.5574 - val_loss: 0.6799 - val_accuracy: 0.5718 - 17s/epoch - 25ms/step
Epoch 3/20
679/679 - 24s - loss: 0.6734 - accuracy: 0.5747 - val_loss: 0.6652 - val_accuracy: 0.5959 - 24s/epoch - 36ms/step
Epoch 4/20
679/679 - 24s - loss: 0.6624 - accuracy: 0.5782 - val_loss: 0.6557 - val_accuracy: 0.5959 - 24s/epoch - 35ms/step
Epoch 5/20
679/679 - 21s - loss: 0.6581 - accuracy: 0.5884 - val_loss: 0.6562 - val_accuracy: 0.5766 - 21s/epoch - 31ms/step
Epoch 6/20
679/679 - 18s - loss: 0.6530 - accuracy: 0.5924 - val_loss: 0.6443 - val_accuracy: 0.6009 - 18s/epoch - 26ms/step
Epoch 7/20
679/679 - 17s - loss: 0.6434 - accuracy: 0.5982 - val_loss: 0.6042 - val_accuracy: 0.6699 - 17s/epoch - 25ms/step
Epoch 8/20
679/679 - 18s - loss: 0.3500 - accuracy: 0.8231 - val_loss: 0.0090 - val_accuracy: 1.0000 - 18s/epoch - 26ms/step
Epoch 9/20
679/679 - 20s - loss: 0.0865 - accuracy: 0.9746 - val_loss: 6.3475e-04 - val_accuracy: 1.0000 - 20s/epoch - 29ms/step
Epoch 10/20
679/679 - 20s - loss: 0.0414 - accuracy: 0.9880 - val_loss: 0.0078 - val_accuracy: 1.0000 - 20s/epoch - 29ms/step
Epoch 11/20
679/679 - 18s - loss: 0.0240 - accuracy: 0.9940 - val_loss: 0.0064 - val_accuracy: 0.9998 - 18s/epoch - 27ms/step
Epoch 12/20
679/679 - 18s - loss: 0.0212 - accuracy: 0.9962 - val_loss: 0.0016 - val_accuracy: 1.0000 - 18s/epoch - 26ms/step
Epoch 13/20
679/679 - 23s - loss: 0.0015 - accuracy: 0.9999 - val_loss: 2.9276e-04 - val_accuracy: 1.0000 - 23s/epoch - 34ms/step
Epoch 14/20
679/679 - 28s - loss: 8.4165e-04 - accuracy: 1.0000 - val_loss: 1.2289e-04 - val_accuracy: 1.0000 - 28s/epoch - 41ms/step
Epoch 15/20
679/679 - 20s - loss: 0.0384 - accuracy: 0.9889 - val_loss: 5.6981e-04 - val_accuracy: 1.0000 - 20s/epoch - 30ms/step
Epoch 16/20
679/679 - 17s - loss: 0.0295 - accuracy: 0.9905 - val_loss: 3.5607e-04 - val_accuracy: 1.0000 - 17s/epoch - 26ms/step
Epoch 17/20
679/679 - 17s - loss: 0.0103 - accuracy: 0.9975 - val_loss: 1.8045e-04 - val_accuracy: 1.0000 - 17s/epoch - 25ms/step
Epoch 18/20
679/679 - 18s - loss: 3.1597e-04 - accuracy: 1.0000 - val_loss: 1.3846e-04 - val_accuracy: 1.0000 - 18s/epoch - 26ms/step
Epoch 19/20
679/679 - 18s - loss: 2.3707e-04 - accuracy: 1.0000 - val_loss: 7.1718e-05 - val_accuracy: 1.0000 - 18s/epoch - 27ms/step
Epoch 20/20
679/679 - 18s - loss: 0.2250 - accuracy: 0.8992 - val_loss: 0.1664 - val_accuracy: 0.9864 - 18s/epoch - 26ms/step
Inference on all the spots...
144.0 in total
Batch 0 processing...
Batch 0 completed. Time taken: 00:00:19
Batch 1 processing...
Batch 1 completed. Time taken: 00:00:19
Batch 2 processing...
Batch 2 completed. Time taken: 00:00:21
Batch 3 processing...
Batch 3 completed. Time taken: 00:00:18
Batch 4 processing...
Batch 4 completed. Time taken: 00:00:17
Batch 5 processing...
Batch 5 completed. Time taken: 00:00:17
Batch 6 processing...
Batch 6 completed. Time taken: 00:00:18
Batch 7 processing...
Batch 7 completed. Time taken: 00:00:18
Batch 8 processing...
Batch 8 completed. Time taken: 00:00:18
Batch 9 processing...
Batch 9 completed. Time taken: 00:00:22
Batch 10 processing...
Batch 10 completed. Time taken: 00:00:19
Batch 11 processing...
Batch 11 completed. Time taken: 00:00:18
Batch 12 processing...
Batch 12 completed. Time taken: 00:00:18
Batch 13 processing...
Batch 13 completed. Time taken: 00:00:18
Batch 14 processing...
Batch 14 completed. Time taken: 00:00:18
Batch 15 processing...
Batch 15 completed. Time taken: 00:00:18
Batch 16 processing...
Batch 16 completed. Time taken: 00:00:19
Batch 17 processing...
Traceback (most recent call last):
  File "/mnt/md0/lei/projects/CellSegmentsation/CellSegmentation/minibatch/NEW_trans.py", line 427, in <module>
    train()
  File "/mnt/md0/lei/projects/CellSegmentsation/CellSegmentation/minibatch/NEW_trans.py", line 400, in train
    run_experiment(
  File "/mnt/md0/lei/projects/CellSegmentsation/CellSegmentation/minibatch/NEW_trans.py", line 281, in run_experiment
    x_test_batch, x_test_pos_batch, x_test_labels_batch = load_batch(
  File "/mnt/md0/lei/projects/CellSegmentsation/CellSegmentation/minibatch/NEW_trans.py", line 34, in load_batch
    x_test_pos=np.load("dataset/x_test_pos.npz",allow_pickle=True)["x_test_pos"][start_idx : start_idx + batch_size].astype(int)
  File "/home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/numpy/lib/npyio.py", line 420, in load
    ret = NpzFile(fid, own_fid=own_fid, allow_pickle=allow_pickle,
  File "/home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/numpy/lib/npyio.py", line 187, in __init__
    _zip = zipfile_factory(fid)
  File "/home/lei/miniconda3/envs/CS/lib/python3.9/site-packages/numpy/lib/npyio.py", line 103, in zipfile_factory
    return zipfile.ZipFile(file, *args, **kwargs)
  File "/home/lei/miniconda3/envs/CS/lib/python3.9/zipfile.py", line 1266, in __init__
    self._RealGetContents()
  File "/home/lei/miniconda3/envs/CS/lib/python3.9/zipfile.py", line 1333, in _RealGetContents
    raise BadZipFile("File is not a zip file")
zipfile.BadZipFile: File is not a zip file
第二个脚本已完成运行
Number of points above threshold: 120636
Total number of points: 1440000
Number of nuclei: 1112
Number of zeros: 1319717
Number of non-zeros: 120283
第三个脚本已完成
/mnt/md0/lei/projects/CellSegmentsation/CellSegmentation/minibatch/NEW_seg.py:15: RuntimeWarning: invalid value encountered in arccos
  angle = np.arccos(dot_product)
loading data

calculating exp and centroids of nucleus

executing field segmentation

1.0 /144 batches completed!
2.0 /144 batches completed!
3.0 /144 batches completed!
4.0 /144 batches completed!
5.0 /144 batches completed!
6.0 /144 batches completed!
7.0 /144 batches completed!
8.0 /144 batches completed!
9.0 /144 batches completed!
10.0 /144 batches completed!
11.0 /144 batches completed!
12.0 /144 batches completed!
13.0 /144 batches completed!
14.0 /144 batches completed!
15.0 /144 batches completed!
16.0 /144 batches completed!
17.0 /144 batches completed!
18.0 /144 batches completed!
19.0 /144 batches completed!
20.0 /144 batches completed!
21.0 /144 batches completed!
22.0 /144 batches completed!
23.0 /144 batches completed!
24.0 /144 batches completed!
25.0 /144 batches completed!
26.0 /144 batches completed!
27.0 /144 batches completed!
28.0 /144 batches completed!
29.0 /144 batches completed!
30.0 /144 batches completed!
31.0 /144 batches completed!
32.0 /144 batches completed!
33.0 /144 batches completed!
34.0 /144 batches completed!
35.0 /144 batches completed!
36.0 /144 batches completed!
37.0 /144 batches completed!
38.0 /144 batches completed!
39.0 /144 batches completed!
40.0 /144 batches completed!
41.0 /144 batches completed!
42.0 /144 batches completed!
43.0 /144 batches completed!
44.0 /144 batches completed!
45.0 /144 batches completed!
46.0 /144 batches completed!
47.0 /144 batches completed!
48.0 /144 batches completed!
49.0 /144 batches completed!
50.0 /144 batches completed!
51.0 /144 batches completed!
52.0 /144 batches completed!
53.0 /144 batches completed!
54.0 /144 batches completed!
55.0 /144 batches completed!
56.0 /144 batches completed!
57.0 /144 batches completed!
58.0 /144 batches completed!
59.0 /144 batches completed!
60.0 /144 batches completed!
X:503.0	Y:1194.0	total:1.074133272897921e-05	 sim:0.005138055222088836	 dis:0.002090544430663477
61.0 /144 batches completed!
62.0 /144 batches completed!
63.0 /144 batches completed!
64.0 /144 batches completed!
65.0 /144 batches completed!
X:541.0	Y:1187.0	total:1.0955075944599479e-05	 sim:0.0033133253301320525	 dis:0.0033063689354533936
66.0 /144 batches completed!
67.0 /144 batches completed!
68.0 /144 batches completed!
69.0 /144 batches completed!
70.0 /144 batches completed!
71.0 /144 batches completed!
72.0 /144 batches completed!
73.0 /144 batches completed!
74.0 /144 batches completed!
75.0 /144 batches completed!
76.0 /144 batches completed!
77.0 /144 batches completed!
78.0 /144 batches completed!
79.0 /144 batches completed!
80.0 /144 batches completed!
81.0 /144 batches completed!
82.0 /144 batches completed!
83.0 /144 batches completed!
84.0 /144 batches completed!
85.0 /144 batches completed!
86.0 /144 batches completed!
87.0 /144 batches completed!
88.0 /144 batches completed!
89.0 /144 batches completed!
90.0 /144 batches completed!
91.0 /144 batches completed!
92.0 /144 batches completed!
93.0 /144 batches completed!
94.0 /144 batches completed!
95.0 /144 batches completed!
96.0 /144 batches completed!
97.0 /144 batches completed!
98.0 /144 batches completed!
99.0 /144 batches completed!
100.0 /144 batches completed!
101.0 /144 batches completed!
102.0 /144 batches completed!
103.0 /144 batches completed!
104.0 /144 batches completed!
105.0 /144 batches completed!
106.0 /144 batches completed!
107.0 /144 batches completed!
108.0 /144 batches completed!
109.0 /144 batches completed!
110.0 /144 batches completed!
111.0 /144 batches completed!
112.0 /144 batches completed!
113.0 /144 batches completed!
114.0 /144 batches completed!
115.0 /144 batches completed!
116.0 /144 batches completed!
117.0 /144 batches completed!
118.0 /144 batches completed!
119.0 /144 batches completed!
120.0 /144 batches completed!
121.0 /144 batches completed!
122.0 /144 batches completed!
123.0 /144 batches completed!
124.0 /144 batches completed!
125.0 /144 batches completed!
126.0 /144 batches completed!
127.0 /144 batches completed!
128.0 /144 batches completed!
129.0 /144 batches completed!
130.0 /144 batches completed!
131.0 /144 batches completed!
132.0 /144 batches completed!
133.0 /144 batches completed!
134.0 /144 batches completed!
135.0 /144 batches completed!
136.0 /144 batches completed!
137.0 /144 batches completed!
138.0 /144 batches completed!
139.0 /144 batches completed!
140.0 /144 batches completed!
141.0 /144 batches completed!
142.0 /144 batches completed!
143.0 /144 batches completed!
144.0 /144 batches completed!
drawing figures

Average size: 662.7329136690647
Std: 316.4305015291436
第四个脚本已完成
